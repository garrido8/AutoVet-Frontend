<div class="main-content">

  @if ( !isAdmin ) {
    <h1 class="section-title">Mis incidencias</h1>

    @if( workerAppoinments.length > 0 ) {
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Título</th>
              <th>Descripción</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            @for (appoinment of workerAppoinments; track $index) {
              <tr routerLink="/staff/appointment-info/{{ appoinment.pk }}">
                <td>{{ appoinment.titulo }}</td>
                <td>{{ appoinment.descripcion }}</td>
                <td>
                  <span class="status-pill status-{{ appoinment.estado | lowercase }}">
                    {{ getDisplayStatus( appoinment.estado )}}
                  </span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <p class="no-data-message">No tienes incidencias asignadas.</p>
    }

    <hr>
  }


  @if( isAdmin ) {
    <h1 class="section-title">Incidencias</h1>
  } @else {
    <h2 class="section-title">Incidencias</h2>
  }

  @if( allAppoinments.length > 0 ) {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Estado</th>
            @if( isAdmin ) {
              <th>Asignado a</th>
            } @else {
              <th>Acción</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (appoinment of allAppoinments; track $index) {
            <tr [routerLink]="isAdmin ? '/staff/appointment-info/' + appoinment.pk : null">
              <td>{{ appoinment.titulo }}</td>
              <td>{{ appoinment.descripcion }}</td>
              <td>
                <span class="status-pill status-{{ appoinment.estado | lowercase }}">
                  {{ getDisplayStatus( appoinment.estado )}}
                </span>
              </td>
              @if( !isAdmin ) {
                <td>
                  <button (click)="assignAppoinment(appoinment)" class="assign-btn">
                    Asignar
                  </button>
                </td>
              } @else {
                <td>{{ appoinment.workerName || 'No asignado' }}</td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <p class="no-data-message">No hay incidencias disponibles para asignar.</p>
  }
</div>
